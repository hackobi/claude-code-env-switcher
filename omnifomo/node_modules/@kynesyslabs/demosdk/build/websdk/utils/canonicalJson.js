"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.canonicalJSONStringify = canonicalJSONStringify;
exports.validatePureJson = validatePureJson;
exports.looksLikeJsonString = looksLikeJsonString;
function canonicalJSONStringify(value) {
    strictValidate(value, new Set());
    return stableStringify(value);
}
// Strict validation: reject undefined/function/symbol/BigInt anywhere
function strictValidate(value, seen) {
    const t = typeof value;
    if (t === "undefined" ||
        t === "function" ||
        t === "symbol" ||
        t === "bigint") {
        throw new Error(`Non-JSON value encountered: ${t}`);
    }
    if (value === null)
        return;
    if (t !== "object")
        return;
    if (seen.has(value))
        throw new Error("Circular reference detected in JSON payload");
    seen.add(value);
    if (Array.isArray(value)) {
        for (const v of value)
            strictValidate(v, seen);
        return;
    }
    const proto = Object.getPrototypeOf(value);
    if (proto !== Object.prototype && proto !== null) {
        throw new Error(`Only plain objects are supported. Found prototype: ${proto?.constructor?.name}`);
    }
    for (const v of Object.values(value)) {
        strictValidate(v, seen);
    }
}
function validatePureJson(value, seen = new Set()) {
    // Backward-compatible validator: same strict rules as above
    strictValidate(value, seen);
}
function looksLikeJsonString(str) {
    const s = str.trim();
    return ((s.startsWith("{") && s.endsWith("}")) ||
        (s.startsWith("[") && s.endsWith("]")));
}
function stableStringify(value) {
    const t = typeof value;
    if (value === null || t === "number" || t === "boolean" || t === "string") {
        return JSON.stringify(value);
    }
    if (Array.isArray(value)) {
        const items = value.map(v => stableStringify(v));
        return `[${items.join(",")}]`;
    }
    // object (validated as plain)
    const obj = value;
    const keys = Object.keys(obj).sort();
    const parts = [];
    for (const key of keys) {
        const k = JSON.stringify(key);
        const v = stableStringify(obj[key]);
        parts.push(`${k}:${v}`);
    }
    return `{${parts.join(",")}}`;
}
//# sourceMappingURL=canonicalJson.js.map