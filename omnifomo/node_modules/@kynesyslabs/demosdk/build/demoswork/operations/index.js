"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DemosWorkOperation = void 0;
const utils_1 = require("../utils");
const datatypes_1 = require("../../types/demoswork/datatypes");
class DemosWorkOperation {
    constructor() {
        this.id = "op_" + (0, utils_1.getNewUID)();
        this.steps = {};
        this.operations = new Set();
        this.output = {
            success: {
                type: datatypes_1.DataTypes.work,
                src: {
                    self: this,
                    key: "output.success",
                },
            },
        };
        this.operationScript = {
            id: this.id,
            operationType: null,
            critical: false,
            depends_on: [],
        };
        // execute() {
        //     throw new Error("Method not implemented.")
        // }
    }
    // GETTERS AND SETTERS
    get critical() {
        return this.operationScript.critical;
    }
    get depends_on() {
        return this.operationScript.depends_on;
    }
    set critical(value) {
        this.operationScript.critical = value;
    }
    // GETTERS AND SETTERS END
    addWork(work) {
        // INFO: The action can be a step or an operation
        // If it is an operation, copy its steps into this operation
        // if is a step, add it to the steps of this operation
        if (work.id.startsWith("op_")) {
            this.operations.add(work);
            // INFO: Inherit the steps of the operation
            for (const stepUID in work.steps) {
                this.steps[stepUID] = work.steps[stepUID];
            }
            // INFO: Inherit the operations of the operation
            for (const operation of work.operations) {
                this.operations.add(operation);
            }
            return;
        }
        if (work.id.startsWith("step_")) {
            this.steps[work.id] = work;
            return;
        }
        throw new Error("Invalid work unit with id:" + work.id);
    }
}
exports.DemosWorkOperation = DemosWorkOperation;
//# sourceMappingURL=index.js.map