"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = createTestWorkScript;
const chainProviders_1 = __importDefault(require("../../tests/multichain/chainProviders"));
const _1 = require(".");
const work_1 = require("../work");
const workstep_1 = require("../workstep");
const core_1 = require("../../multichain/core");
const steps_1 = require("../../types/demoswork/steps");
const websdk_1 = require("../../websdk");
const conditional_1 = require("../operations/conditional");
const baseoperation_1 = require("../operations/baseoperation");
async function createTestWorkScript() {
    const work = new work_1.DemosWork();
    const uid = (0, _1.getNewUID)();
    const evm = await core_1.EVM.create(chainProviders_1.default.eth.sepolia);
    await evm.connectWallet("e0a00e307c21850cde41b18bae307a492c471b463b60ce5b631fdb80503b23f7");
    const payload = await evm.preparePay(evm.getAddress(), "0.0001");
    const sendEth = (0, workstep_1.prepareXMStep)({
        operations: {
            [uid]: {
                chain: "eth",
                is_evm: true,
                rpc: null,
                subchain: "sepolia",
                task: {
                    params: null,
                    signedPayloads: [payload],
                    type: "pay",
                },
            },
        },
        operations_order: [uid],
    });
    sendEth.description = "Send ETH";
    // WEB2 STEP
    const sendHash = (0, workstep_1.prepareWeb2Step)({
        url: "https://icanhazip.com",
        method: "GET",
    });
    sendHash.description = "Send xm hash to HTTP API";
    const operation = new conditional_1.ConditionalOperation();
    operation
        .if(sendEth.output.result, "==", steps_1.XmStepResult.success)
        .then(sendHash)
        .elif(sendEth.output.result, "==", steps_1.XmStepResult.error)
        .then(sendHash);
    const baseOperation = new baseoperation_1.BaseOperation();
    baseOperation.addWork(sendEth);
    console.log("baseOperation", baseOperation);
    work.push(baseOperation);
    const script = work.toJSON();
    console.log(script);
    // INFO: Create private key and return the signed transaction
    const identity = websdk_1.DemosWebAuth.getInstance();
    await identity.create();
    const demos = new websdk_1.Demos();
    await demos.connectWallet("entire vocal party hold witness glimpse damp cat small type whale cry", { algorithm: "ed25519" });
    return await (0, work_1.prepareDemosWorkPayload)(work, demos);
}
//# sourceMappingURL=createTestWorkScript.js.map