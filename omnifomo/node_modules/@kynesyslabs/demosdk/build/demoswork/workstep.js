"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NativeWorkStep = exports.XmWorkStep = exports.Web2WorkStep = exports.WorkStep = void 0;
exports.prepareXMStep = prepareXMStep;
exports.prepareWeb2Step = prepareWeb2Step;
exports.prepareNativeStep = prepareNativeStep;
const utils_1 = require("./utils");
const websdk_1 = require("../websdk");
const datatypes_1 = require("../types/demoswork/datatypes");
const types_1 = require("../types");
class WorkStep {
    constructor(payload) {
        this.timestamp = Date.now();
        this.critical = false;
        this.depends_on = [];
        this.content = payload;
        this.id = "step_" + (0, utils_1.getNewUID)();
    }
    get output() {
        return new Proxy({
            type: datatypes_1.DataTypes.work,
            src: {
                self: this,
                key: "output",
            },
        }, {
            get: (target, prop) => {
                return {
                    type: datatypes_1.DataTypes.work,
                    src: {
                        self: this,
                        key: `output.${String(prop)}`,
                    },
                };
            },
        });
    }
    get base_output() {
        return this.output;
    }
}
exports.WorkStep = WorkStep;
class Web2WorkStep extends WorkStep {
    constructor(payload) {
        super(payload);
        this.context = "web2";
    }
}
exports.Web2WorkStep = Web2WorkStep;
class XmWorkStep extends WorkStep {
    constructor(payload) {
        super(payload);
        this.context = "xm";
    }
}
exports.XmWorkStep = XmWorkStep;
class NativeWorkStep extends WorkStep {
    constructor(payload) {
        super(payload);
        this.context = "native";
    }
}
exports.NativeWorkStep = NativeWorkStep;
// SECTION: Prepare functions
function prepareXMStep(xm_payload) {
    return new XmWorkStep(xm_payload);
}
function prepareWeb2Step({ method = "GET", url = "https://icanhazip.com", parameters = [], headers = null, }) {
    // Generating an empty request and filling it
    const web2_payload = structuredClone(websdk_1.skeletons.web2_request);
    web2_payload.raw.action = types_1.EnumWeb2Actions.CREATE;
    web2_payload.raw.method = method;
    web2_payload.raw.url = url;
    web2_payload.raw.parameters = parameters;
    web2_payload.raw.headers = headers;
    // Ensuring content is a known property
    web2_payload.hash = "";
    web2_payload.signature = {
        type: "ed25519",
        data: null,
    };
    web2_payload.result = "";
    return new Web2WorkStep(web2_payload);
}
function prepareNativeStep(native_payload) {
    return new NativeWorkStep(native_payload);
}
//# sourceMappingURL=workstep.js.map