"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ToncoOnChainTrade = void 0;
const errors_1 = require("../../../../../../common/utils/errors");
const on_chain_trade_type_1 = require("../../common/models/on-chain-trade-type");
const ton_on_chain_trade_1 = require("../../common/on-chain-trade/ton-on-chain-trade/ton-on-chain-trade");
const tonco_sdk_facade_1 = require("./services/tonco-sdk-facade");
class ToncoOnChainTrade extends ton_on_chain_trade_1.TonOnChainTrade {
    constructor(tradeStruct, providerAddress) {
        super(tradeStruct, providerAddress);
        this.type = on_chain_trade_type_1.ON_CHAIN_TRADE_TYPE.TONCO_DEX;
        this.params = tradeStruct.params;
    }
    async swap(options = {}) {
        let transactionHash;
        const onTransactionHash = (hash) => {
            if (options.onConfirm) {
                options.onConfirm(hash);
            }
            transactionHash = hash;
        };
        await this.checkWalletState(options?.testMode);
        await this.makePreSwapChecks({
            fromAddress: this.walletAddress,
            receiverAddress: options.receiverAddress,
            skipAmountCheck: this.skipAmountCheck,
            ...(options?.referrer && { referrer: options?.referrer })
        });
        const tonEncodedConfig = await tonco_sdk_facade_1.ToncoSdkFacade.createTonConfig(this.params, this.from.weiAmount, this.to.weiAmountMinusSlippage(this.slippageTolerance));
        try {
            await this.web3Private.sendTransaction({
                onTransactionHash,
                messages: [tonEncodedConfig]
            });
            return transactionHash;
        }
        catch (err) {
            throw (0, errors_1.parseError)(err);
        }
    }
    async calculateOutputAmount(_options) {
        const amountOutWei = await tonco_sdk_facade_1.ToncoSdkFacade.calculateAmountOut(this.params, this.from);
        return amountOutWei.toFixed();
    }
}
exports.ToncoOnChainTrade = ToncoOnChainTrade;
//# sourceMappingURL=tonco-on-chain-trade.js.map