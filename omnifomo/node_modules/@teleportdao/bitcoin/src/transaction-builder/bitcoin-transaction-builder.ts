import * as bitcoin from "bitcoinjs-lib"
import { BaseTransactionBuilder } from "./transaction-builder"
import { BitcoinInterfaceWallet } from "../bitcoin-interface-wallet"
import { BitcoinInterface } from "../bitcoin-interface"
import { BitcoinConnectionInfo } from "../type"

export class BitcoinTransactionBuilder extends BaseTransactionBuilder {
  btcInterface: BitcoinInterfaceWallet
  constructor(
    networkName: string,
    network = bitcoin.networks.bitcoin,
    connectionInfo?: BitcoinConnectionInfo,
  ) {
    super({
      network,
      testnet: networkName?.includes("_testnet"),
      dustLimit: 1000,
    })
    this.btcInterface = new BitcoinInterface(networkName, connectionInfo)
  }

  // eslint-disable-next-line no-underscore-dangle
  async _getTransactionHex(transactionId: string): Promise<string> {
    return this.btcInterface.getRawTransaction(transactionId)
  }
}
