import EthConnectorLogicABI from "../../abis/teleswap/EthConnectorLogic"
import ContractBase from "../contract-base"
import { ConnectionConfig } from "../../types"

export class EthConnector extends ContractBase<typeof EthConnectorLogicABI> {
  constructor(connectionConfig: ConnectionConfig, contractAddress: string) {
    super(connectionConfig, contractAddress, EthConnectorLogicABI)
  }

  swapAndUnwrap(
    exchangeInfo: {
      ethTokenAddress: string
      exchangeConnector: string
      destinationPath: string[]
      inputAmount: number | string
      outputAmount: number | string
      isFixedToken: boolean
      isNativeToken?: boolean
    },
    receiverBitcoinScript: string,
    addressTypeNumber: number,
    lockerLockingScript: string,
    thirdPartyId: number = 0,
    relayerFeePercentage: string,
  ) {
    const { value, params } = EthConnector.swapAndUnwrapParams(
      exchangeInfo,
      receiverBitcoinScript,
      addressTypeNumber,
      lockerLockingScript,
      thirdPartyId,
      relayerFeePercentage,
    )
    return this.contractSendMethodNoError("swapAndUnwrap", value, params)
  }

  static swapAndUnwrapParams(
    exchangeInfo: {
      ethTokenAddress: string
      exchangeConnector: string
      destinationPath: string[]
      inputAmount: number | string
      outputAmount: number | string
      isFixedToken: boolean
      isNativeToken?: boolean
    },
    receiverBitcoinScript: string,
    addressTypeNumber: number,
    lockerLockingScript: string,
    thirdPartyId: number = 0,
    relayerFeePercentage: string,
  ) {
    const value = exchangeInfo.isNativeToken || false ? exchangeInfo.inputAmount.toString() : "0"
    const params = [
      exchangeInfo.ethTokenAddress,
      exchangeInfo.exchangeConnector,
      [exchangeInfo.inputAmount, exchangeInfo.outputAmount],
      exchangeInfo.isFixedToken,
      exchangeInfo.destinationPath,
      [receiverBitcoinScript, addressTypeNumber, lockerLockingScript],
      relayerFeePercentage,
      thirdPartyId,
    ]
    return {
      params,
      value,
    }
  }
}
export default EthConnector
