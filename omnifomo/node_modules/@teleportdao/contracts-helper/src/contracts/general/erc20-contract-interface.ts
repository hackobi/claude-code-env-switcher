import { BigNumber } from "bignumber.js"
import { ERC20ABI } from "../../abis"
import ContractBase from "../contract-base"
import { ConnectionConfig } from "../../types/eth"

export class ERC20 extends ContractBase<typeof ERC20ABI> {
  unit: number | undefined
  constructor(connectionConfig: ConnectionConfig, contractAddress: string, unit?: number) {
    super(connectionConfig, contractAddress, ERC20ABI)
    this.unit = unit
  }

  async setDecimal() {
    let decimal = await this.contract.methods.decimals().call()
    this.unit = +decimal.toString()
    return decimal
  }

  async getDecimal() {
    let decimal = await this.setDecimal()
    return decimal
  }

  async getSymbol() {
    return this.contract.methods.symbol().call()
  }

  async getName() {
    return this.contract.methods.name().call()
  }

  async getBalance(address?: string) {
    let balance = await this.contract.methods.balanceOf(address || this.currentAccount).call()
    return balance
  }

  async getApprovedBalanceForAddress(address: string) {
    let balance = await this.contract.methods.allowance(this.currentAccount, address).call()
    return balance
  }

  async approve(address: string, amount: number | string) {
    return this.contractSendMethod("approve", "0", [address, amount])
  }

  async transfer(receiver: string, amount: number | string) {
    return this.contractSendMethod("transfer", "0", [receiver, amount])
  }

  async transferAll(receiver: string) {
    let balance = await this.getBalance()
    return this.transfer(receiver, balance.toString())
  }
}
export default ERC20
