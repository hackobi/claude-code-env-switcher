import * as OrdinalProviders from "./ordinal"
import * as ApiProviders from "./api"
import * as UtxoProviders from "./utxo"
import { UtxoProvider } from "./types"
import { BitcoinRPC } from "./rpc"
import { TeleportDao } from "../teleportdao"

export * from "./ordinal"
export * from "./api"
export * from "./utxo"
export * from "./rpc"
export * as Types from "./types"

export function getUtxoProvider(
  connectionInfo: {
    token?: string
    provider: "BlockStream" | "NowNodes" | "MempoolSpace" | "Unisat" | "TeleportDao"
  },
  networkName?: string,
): UtxoProvider {
  let testnet = !!networkName?.includes("_testnet")

  if (connectionInfo.provider === "TeleportDao") {
    return new TeleportDao(testnet)
  }
  if (connectionInfo.provider === "BlockStream" || connectionInfo.provider === "MempoolSpace") {
    return new ApiProviders[connectionInfo.provider](testnet)
  }
  if (connectionInfo.provider === "NowNodes") {
    if (!connectionInfo.token) throw new Error("Provider Needs Token")
    return new UtxoProviders.NowNodes({ token: connectionInfo.token }, testnet)
  }
  if (connectionInfo.provider === "Unisat") {
    if (!connectionInfo.token) throw new Error("Provider Needs Token")
    return new OrdinalProviders.UniSat({ token: connectionInfo.token }, testnet)
  }

  throw new Error("provider not supported")
}

export function getRpcProvider(connectionInfo: {
  url: string
  headers?: {
    [key: string]: string
  }
  auth?: {
    username: string
    password: string
  }
}) {
  return new BitcoinRPC(connectionInfo)
}
