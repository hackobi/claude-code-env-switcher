// not complete
import axios, { AxiosInstance } from "axios"

type SupportedNetwork = "polygon" | "bsc" | "bsquared"
type CrossChainNetwork = "ethereum" | "optimism" | "arbitrum" | "base"
type AllNetwork = SupportedNetwork | CrossChainNetwork

type SignerInfo = {
  address: string
  publicKey: string
  addressType: string // "p2sh-p2wpkh" | "p2tr" | "p2wpkh" | "p2pkh"
  derivationPath?: string
  masterFingerprint?: string
}

export type ExtendedUtxo = {
  signerInfo: SignerInfo
  hash: string
  value: number
  index: number
}

export class TeleswapUtilsAPI {
  api: AxiosInstance
  constructor(url = "https://api.teleportdao.xyz/api") {
    this.api = axios.create({
      baseURL: url,
    })
  }

  async wrapAndSwapEstimate(
    amountBTC: string,
    networkName: AllNetwork,
    outputToken?: string,
    thirdPartyId?: number,
  ) {
    return (
      await this.api.post("/v2/teleswap/utils/wrap-and-swap-estimate", {
        amountBTC,
        networkName,
        outputToken,
        thirdPartyId,
      })
    ).data
  }

  async wrapAndSwapUnsigned(
    recipientAddress: string,
    amountBTC: string,
    signer: SignerInfo,
    networkName: AllNetwork,
    outputToken?: string,
    minOutputAmount?: string,
    changeAddress?: string,
    staticFeeRate?: number,
    staticUTXO?: ExtendedUtxo[],
    fullAmount?: boolean,
    thirdPartyId?: number,
  ) {
    return (
      await this.api.post("/v2/teleswap/utils/wrap-and-swap-unsigned", {
        recipientAddress,
        amountBTC,
        signer,
        networkName,
        outputToken,
        minOutputAmount,
        changeAddress,
        staticFeeRate,
        staticUTXO,
        thirdPartyId,
      })
    ).data
  }

  async swapAndUnwrapEstimate(
    exchangeInfo: {
      inputToken?: string
      inputAmount: string
      isFixedToken?: boolean
    },
    networkName: AllNetwork,
    thirdPartyId?: number,
  ) {
    return (
      await this.api.post("/v2/teleswap/utils/swap-and-unwrap-estimate", {
        exchangeInfo,
        networkName,
        thirdPartyId,
      })
    ).data
  }

  async swapAndUnwrapInputs(
    exchangeInfo: {
      inputToken?: string
      inputAmount: string
      isFixedToken?: boolean
    },
    bitcoinAddress: string,
    networkName: AllNetwork,
    minBtcAmount?: string,
    thirdPartyId?: number,
  ) {
    return (
      await this.api.post("/v2/teleswap/utils/swap-and-unwrap-inputs", {
        exchangeInfo,
        bitcoinAddress,
        networkName,
        minBtcAmount,
        thirdPartyId,
      })
    ).data
  }
}
