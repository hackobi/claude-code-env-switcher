import { BigNumber } from "bignumber.js"
import { toChecksumAddress } from "web3-utils"
import { tokens } from "@teleportdao/configs"
import { contracts } from "@teleportdao/contracts-helper"
import { TeleswapSDK } from "../src"

async function start() {
  console.log("start")

  const sdk = new TeleswapSDK()
  await sdk.initNetworksConnection()
  await sdk.setThirdPartyId(10)

  const network = "polygon"
  const crosschainNetwork = "optimism"
  const crossTokens = tokens[crosschainNetwork].mainnet
  const networkTokens = tokens[network].mainnet

  const wrapEstimate = await sdk.wrapEstimate("0.001", network)
  console.log("wrapEstimate", JSON.stringify(wrapEstimate, null, 2))

  const wrapAndSwapEstimate = await sdk.wrapAndSwapEstimate(
    "0.0004",
    network,
    networkTokens.USDCAddress,
  )
  console.log("wrapAndSwapEstimate", JSON.stringify(wrapAndSwapEstimate, null, 2))

  const wrapAndSwapNativeTokenEstimate = await sdk.wrapAndSwapEstimate("0.0004", network)
  console.log(
    "wrapAndSwapNativeTokenEstimate",
    JSON.stringify(wrapAndSwapNativeTokenEstimate, null, 2),
  )

  // crosschain
  const wrapAndSwapCrossChainEstimate = await sdk.wrapAndSwapEstimate(
    "0.001",
    crosschainNetwork,
    crossTokens.USDCAddress,
  )
  console.log(
    "wrapAndSwapCrossChainEstimate",
    JSON.stringify(wrapAndSwapCrossChainEstimate, null, 2),
  )

  const wrapAndSwapCrossChainNativeTokenEstimate = await sdk.wrapAndSwapEstimate(
    "0.001",
    crosschainNetwork,
  )
  console.log(
    "wrapAndSwapCrossChainNativeTokenEstimate",
    JSON.stringify(wrapAndSwapCrossChainNativeTokenEstimate, null, 2),
  )

  // normal
  const unwrapEstimate = await sdk.unwrapEstimate("0.001", network)
  console.log("unwrapEstimate", JSON.stringify(unwrapEstimate, null, 2))

  const token = new contracts.ERC20(
    sdk.getNetwork(network).targetConnectionConfig,
    toChecksumAddress(networkTokens.USDTAddress!),
  )
  const decimal = +(await token.getDecimal()).toString()
  const amount = BigNumber("100")
    .multipliedBy(10 ** decimal)
    .toFixed(0)

  // normal
  const unwrapAndSwapBaseEstimate = await sdk.swapAndUnwrapEstimate(
    {
      inputToken: token.contractAddress!,
      inputAmount: amount,
    },
    network,
  )
  console.log("unwrapAndSwapBaseEstimate", JSON.stringify(unwrapAndSwapBaseEstimate, null, 2))

  const unwrapAndSwapBaseNativeTokenEstimate = await sdk.swapAndUnwrapEstimate(
    {
      // inputToken: undefined,
      inputAmount: (100 * 1e18).toFixed(),
    },
    network,
  )
  console.log(
    "unwrapAndSwapBaseNativeTokenEstimate",
    JSON.stringify(unwrapAndSwapBaseNativeTokenEstimate, null, 2),
  )

  // crosschain

  const crossChainToken = new contracts.ERC20(
    sdk.getCrossChainNetwork(crosschainNetwork).targetConnectionConfig,
    toChecksumAddress(crossTokens.USDCAddress),
  )
  const decimalCrosschain = +(await crossChainToken.getDecimal()).toString()
  const amountCrossChain = BigNumber("100")
    .multipliedBy(10 ** decimalCrosschain)
    .toFixed(0)

  const unwrapAndSwapCrosschainEstimate = await sdk.swapAndUnwrapEstimate(
    {
      inputToken: crossChainToken.contractAddress,
      inputAmount: amountCrossChain,
    },
    crosschainNetwork,
  )
  console.log(
    "unwrapAndSwapCrosschainEstimate",
    JSON.stringify(unwrapAndSwapCrosschainEstimate, null, 2),
  )

  //

  const unwrapAndSwapCrosschainNativeEstimate = await sdk.swapAndUnwrapEstimate(
    {
      inputAmount: (10 * 1e18).toFixed(),
    },
    crosschainNetwork,
  )
  console.log(
    "unwrapAndSwapCrosschainNativeEstimate",
    JSON.stringify(unwrapAndSwapCrosschainNativeEstimate, null, 2),
  )
}

start()
