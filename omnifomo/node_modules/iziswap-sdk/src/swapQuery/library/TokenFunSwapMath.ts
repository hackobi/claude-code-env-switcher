import { SwapQuery } from "./State";
import { SwapMathY2XDesire } from "./SwapMathY2XDesire"
import { SwapMathX2YDesire } from "./SwapMathX2YDesire"
import { LogPowMath } from "./LogPowMath";
import JSBI from "jsbi";

export interface QueryData {
    startPoint: number;
    startLiquidity: string;
    startLiquidityX: string;
    boundaryPoint: number;
    isY2X: boolean;
    desireAmount: string;
}

export function queryTokenFunSwapCost(
    queryData: QueryData
) : string {
    const state = {
        sqrtPrice_96: LogPowMath.getSqrtPrice(queryData.startPoint),
        currentPoint: queryData.startPoint,
        liquidity: JSBI.BigInt(queryData.startLiquidity),
        liquidityX: JSBI.BigInt(queryData.startLiquidityX)
    } as SwapQuery.State;
    if (queryData.isY2X) {
        const { costY } = SwapMathY2XDesire.y2XRange(
            state, queryData.boundaryPoint, LogPowMath.getSqrtPrice(1), JSBI.BigInt(queryData.desireAmount)
        )
        return costY.toString();
    } else {
        const {costX} = SwapMathX2YDesire.x2YRange(
            state, queryData.boundaryPoint, LogPowMath.getSqrtPrice(1), JSBI.BigInt(queryData.desireAmount)
        )
        return costX.toString();
    }
}
